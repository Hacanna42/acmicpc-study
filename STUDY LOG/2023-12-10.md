# <span style="color:yellow">2023-12-10</span>

오늘은 산타 프로젝트의 본격적 배포에 앞서 해결해야 하는 과제들을 정리하고 있다.
일단, 비정상적인 API 브루트포스 공격을 막기 위한 대책으로 AWS WAF를 사용해보기로 결정했다.

좀 더 구체적인 보안을 설정하려면, AWS Lambda와 WAF를 이용한 Rate-Based Blacklisting 기능 (혹은 GuardDuty도 사용할 수 있다.)

근데, 우리 프로젝트가 이렇게 복잡한 프로젝트는 아니니까.. AWS WAF 정도만 사용해도 충분할 것 같다.
(PIN번호에만 추가적으로 보안을 좀 걸어놔야 겠다.)

우리 사이트가 예상보다 더 커지면 AWS Shield Advanced도 고려해봐야한다.

삭제에 대한 모든 audit trail을 남기고
API request를 보내는 IP를 백엔드에서 DB에 date 컬럼과 함께 저장, 들어온 IP가 DB에서 최근 1시간동안 50번 미만 사용됐어야만 통과. 시키는 로직.

그리고 EC2의 사양과 Auto Scailing 정책도 설정해야 한다.

```
### AWS WAF

1. **사용자 정의 규칙 설정**: AWS WAF를 사용하면 사용자 정의 웹 ACL(Access Control List) 규칙을 설정하여 요청을 필터링할 수 있습니다. 이를 통해 특정 조건을 만족하는 요청만을 허용하고 나머지는 차단할 수 있습니다.
    
2. **IP 주소 기반 제한**: 동일 IP 주소에서 너무 많은 요청이 발생하는 경우 이를 자동으로 차단할 수 있는 규칙을 설정할 수 있습니다. 이는 브루트포스 공격을 방지하는데 매우 유용합니다.
    
3. **고급 요청 패턴 분석**: WAF는 복잡한 요청 패턴을 분석하고, 이상 행동을 감지하는 규칙을 설정할 수 있습니다. 예를 들어, 짧은 시간에 `userHash` 값이 지나치게 많이 변경되는 경우 등을 탐지할 수 있습니다.
    
4. **유연성 및 확장성**: AWS WAF는 다양한 AWS 서비스와 통합되어 있어, 필요에 따라 다양한 환경에 적용 가능합니다.
    

### AWS API Gateway

API Gateway 역시 유용한 기능을 제공하지만, 주로 API 관리와 스로틀링, 인증 등에 중점을 두고 있습니다. 브루트포스 공격과 같은 보안 위협에 대응하기 위해서는 API Gateway보다는 WAF의 기능이 더 적합할 수 있습니다.

### 결론

두 서비스 모두 각각의 장점이 있으나, 귀하의 상황에서는 AWS WAF가 더 적합할 것으로 보입니다. WAF를 사용하면 특정 IP 주소나 요청 패턴에 대한 강력한 제어와 필터링 규칙을 설정할 수 있으며, 이를 통해 브루트포스 공격을 효과적으로 차단할 수 있습니다. 그러나 최적의 보안을 위해서는 가능하다면 WAF와 API Gateway를 함께 사용하는 것을 고려하는 것이 좋습니다.
	```