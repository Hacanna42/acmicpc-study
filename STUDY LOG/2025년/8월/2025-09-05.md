- 구구의 Q&A 및 강의 (퀘스트)


---

# 행성이 퀘스트
## 퀘스트 1: HTTP 압축의 마법 - 데이터가 줄어드는 순간
### 🔍 관찰 결과 기록
**무엇을 관찰했나요?**
- 압축 전 데이터 크기: 429
- 압축 후 데이터 크기: 211
- 브라우저가 자동으로 gzip을 요청했나요?: 예
- 압축이 적용된 Content-Type은 무엇이었나요?: application/json

### ❓ 나만의 탐구 질문 만들기
- 질문 1: gzip 압축이 무엇일까?
	- gzip은 GNU zip의 준말이며, 자유 소프트웨어 압축 프로그램이다. .zip과 같은 `DEFLATE` 알고리즘을 따른다. DEFLATE 알고리즘은 중복되는 문자열을 참조하고, 각 문자열의 출현 빈도를 계산하여 파일을 압축한다. 압축률에 비해 압축 해제 속도가 우수하다. 단, 추후 나온 압축 알고리즘보다는 압축률이 낮다. 
- 질문 2: 많은 비용을 절약할 수 있다면 왜 모든 파일을 기본적으로 압축하지 않을까?
	- JPEG, PNG, MP4 같이 이미 강력한 압축 알고리즘을 사용한다. 따라서 HTTP에서 추가적으로 압축해도 거의 용량이 줄지 않으며, 처리 비용만 증가한다.
	- 너무 작은 파일이나 너무 큰 파일의 경우 효율성이 떨어지거나 성능 문제가 있어 모든 파일을 기본적으로 압축하진 않는다.

### 퀘스트 2: 브라우저 캐싱의 비밀 - 304 Not Modified 체험하기
### 관찰 결과 기록
**무엇을 관찰했나요?**
- 첫 요청 시 다운로드 크기:          1007bytes
- 캐시된 요청 시 전송 크기:          0bytes
- 304 응답의 본문 크기:          0bytes  
- 강제 새로고침 시 요청 헤더에 추가된 것:  no-cache
- ETag 값이 일치할 때와 일치하지 않을 때의 차이: 일치하면 304, 불일치하면 200

### 나만의 탐구 질문 만들기
- 질문1: 왜 개발자도구에서 'Disable cache'를 체크하면 매번 200 OK가 올까?
	- 먼저 캐시(Cache)는 자주 사용되는 데이터나 값을 임시로 저장해 두는 저장소로, 이후에 동일한 데이터에 접근할 때 더 빠르게 처리하고 응답할 수 있도록 하는 기술입니다. 여기서 ETag와 Last-Modified 같은 것은 캐시의 유효성 검증 방식입니다. ETag의 경우 응답 본문을 해시 방식처럼 만들어서 가지고 있다가, 비교하고 두 내용이 다를 경우 본문이 업데이트가 되었다고 판단하고 캐시를 사용하지 않습니다. Last-Modified도 마찬가지입니다. 따라서 Disable Cache 옵션을 체크할 경우, 캐시 자체가 동작하지 않고 당연히 캐시의 유효성 검증인 ETag와 Last-Modified도 아무 의미 없게 됩니다.
- 질문2: ETag와 Last-Modified 중 어느 것이 더 정확할까?
	- ETag는 리소스 내용 기반 고유 식별자를 사용하므로, 리소스의 최신 여부를 매우 정확하게 판단할 수 있습니다. 단 ETag 앞에 W/ 가 붙는 경우 약한 검사 모드이기 때문에 조금 덜 정확합니다. 하지만 Last-Modified는 항상 수정 시간을 기준으로 변경을 확인합니다. 서버에서 수정 시간을 항상 정확하게 제공하는 경우 정확하지만, 서버는 리소스가 마지막으로 수정된 날짜와 시간을 항상 응답의 Last-Modified 헤더에 보내야합니다. 따라서 파일 수정 시간이 정확하지 않거나, 수정 시간이 갱신되지 않은 경우 오차가 발생할 수 있습니다.
- 질문3: ETag는 어떻게 정해지는 걸까?
	- HTTP 헤더에서 ETag의 사용은 선택 사항이며, ETag의 생성 방식에 대한 알고리즘은 공식적으로 명시되지 않았습니다. 하지만 일반적인 ETag 생성 방법에는 리소스 내용의 충돌 방지 해시 함수 사용(MD5, SHA-256), 마지막 수정 타임스탬프의 해시, 또는 단순히 수정 번호를 사용하는 방법 등이 포함됩니다.


---

### **1. 캐싱의 두 가지 모드**

- **강제 캐시 (Fresh Cache)**
    
    - Cache-Control: max-age, Expires 등에 의해 아직 **유효기간이 안 지난 경우**
        
    - 브라우저는 서버에 **아무 요청도 안 보냄** → 그냥 (from memory/disk cache)
        
    - 이때 ETag/Last-Modified가 있어도 **쓰이지 않음** (재검증 불필요).
        
    
- **조건부 캐시 (Revalidation)**
    
    - 만료되었거나 no-cache 옵션 같은 게 있으면, 브라우저가 **조건부 요청**을 보냄:
    ```
    If-None-Match: "etag값"
	If-Modified-Since: 날짜
    ```
- - 서버가 변경 없으면 → **304 Not Modified** 반환
        
    - 이때 로컬 캐시된 본문이 조합돼 사용됨.




---


304 Not Modified와 
서버를 찌르지도 않고, from disk(from memory)의 차이를 알게 되었다.
서버에서 Expires 같은 캐시 제어자를 응답하지 않았을 때, 브라우저에서 자체적으로 처리하는 Heuristic caching 에 대해 알게 되었다.

부기와 꽤나 딥 다이브를 했다. 정적 파일의 Last Modified 가 오래 됐을수록, 그만큼 앞으로 바뀔 가능성이 희박하다는 뜻이다.

따라서, 대부분의 브라우저는 Last-Modified 헤더가 존재하고, Expires가 존재하지 않을 때 Heuristic(어림짐작)하게 다음 공식으로 expires를 설정한다.
```
캐시 지속 시간 = (Date - Last-Modified) × 0.1 (10%)
```

즉, 파일이 100초 전에 바뀌었다면- 곧 바뀔 확률이 꽤 있으므로 10초동안만 캐싱한다.
반대로 파일의 마지막 수정이 100년 전이라면, 정말 바뀌지 않는 파일이므로 1년동안 캐싱한다.

### Max-age와 Age, Expires의 차이
Max-age는 "지금부터 N초간 유효" 하다는 상대적인 시간을 나타낸다.
Expires는 "이 시각 이후로 유효하지 않음" 이라는 절대적인 시간을 나타낸다.
Age는 프록시나 CDN이 응답에 추가적으로 기록하는 캐시에 머문 시간이다. 즉 원본 서버에서 캐싱한 지 얼마나(숙성) 되었는가를 나타낸다.


### 클라이언트에서 보내는 Cache-Control: no-cache 오해 해결
클라이언트에서 no-cache를 보내면, 중간 프록시 서버나 CDN에 캐시를 사용하지 않고 원본에서 가져오도록 요청한다.
브라우저에서 강력 새로고침을 할 경우 no-cache와 함께 조건부 검증 헤더가 나가지 않기 때문에, 304 응답을 받지 않는다.


---

###  관찰 결과 기록
**무엇을 관찰했나요?**
- no-cache일 때 새로고침 시 전송된 헤더:  
- no-store일 때 캐시 저장 여부:  
- must-revalidate와 일반 캐싱의 차이:  
- public과 private의 실제 동작 차이:


### 나만의 탐구 질문 만들기
**관찰한 현상에 대해 궁금한 점을 질문으로 만들어보세요**질문 만들기 가이드:- "만약 max-age=0과 no-cache를 함께 사용하면 어떻게 될까?" 형태로 시작해보기  
- "왜 로그인된 사용자 정보는 private으로 설정해야 할까?" 고민해보기  
- "immutable 지시자는 어떤 상황에서 유용할까?" 비교해보기



---


## Arc 버그 트러블슈팅
Arc에서 주소창을 단축키로 여냐, 마우스 여나에 따라 캐싱 여부가 갈린다 ..
이것때문에 엄청 고생했다. must-revalidate를 붙였는데 단축키 사용 여부에 따라 언제는 바디가 받아진다던지 언제는 안된다던지..


### 관찰 결과 기록**무엇을 관찰했나요?**
- no-cache일 때 새로고침 시 전송된 헤더:  없음
- no-store일 때 캐시 저장 여부:  안됨
- must-revalidate와 일반 캐싱의 차이: 일반 캐싱은 만료 시 재검증을 거치고, 네트워크 연결이 없을 시 그냥 만료된 값을 사용함. must-revalidate는 네트워크 연결이 없을 시 만료된 캐시도 사용하지 않음.
- public과 private의 실제 동작 차이:
- ### 나만의 탐구 질문 만들기
- **관찰한 현상에 대해 궁금한 점을 질문으로 만들어보세요**질문 만들기 가이드:- "만약 max-age=0과 no-cache를 함께 사용하면 어떻게 될까?" 형태로 시작해보기  
- "왜 로그인된 사용자 정보는 private으로 설정해야 할까?" 고민해보기  
- "immutable 지시자는 어떤 상황에서 유용할까?" 비교해보기작성 공간:- 질문 1:  
- 질문 2: