- 레벨 4를 본격적으로 시작하기에 앞서, 레벨 3 최종 미션이 시작되었다.
- 요구사항은 다음과 같다:
	1. 애플리케이션을 AWS에 배포 가능한 상태로 구축해야 한다.
	2. 애플리케이션 서버와 데이터베이스 서버를 물리·네트워크 계층에서 분리해야 한다.
	3. 개발(dev)과 운영(prod)의 설정을 서로 독립적으로 관리·배포해야 한다.

- 선택 요구사항도 7가지나 있지만, 일단은 기본 요구사항 먼저 끝내자.
- 1번 요구사항의 경우, 그냥 java파일을 .jar로 빌드에서 서버에서 실행하면 끝난다.
- 2번 요구사항은 서버를 물리적으로 분리하라는 뜻 같다. EC2를 두개 설정하면 될 것 같다.
- 3번은 개발 서버와 운영 서버를 물리적으로 분리하거나, 논리적으로 분리할 수 있도록 포트를 나누거나 하면 끝날 것 같다.


### Tasks
 - [x] EC2 생성 ✅ 2025-09-03
	 - [x] WAS EC2 ✅ 2025-09-03
	 - [x] DB EC2 ✅ 2025-09-03
	 - [x] SSH 연결 확인 ✅ 2025-09-03
- [x] 레벨 2 코드 마이그레이션 ✅ 2025-09-03
	- 레벨 2 최종 미션 코드를, 현재 레포에 마이그레이션한다.
- [x] WAS 띄우기 ✅ 2025-09-03
	- .jar을 빌드해서 EC2에 WAS를 띄운다.
- [x] DB 띄우기 ✅ 2025-09-03
	- DB를 독립적인 EC2에 띄운다.
- [x] WAS <-> DB 연동 ✅ 2025-09-03
	- 프로젝트를 수정해서 DB를 연동한다.
- [x] 환경 분리 ✅ 2025-09-03
	- 개발 환경과 배포 환경을 분리한다.

#### 추가 요구사항
- [ ]  소스 변경 시 자동 빌드·배포가 수행되도록 파이프라인을 구성해야 한다.
	- pipeline은 구성하지 못했지만, sh 파일로 부분 자동화함.
- [ ] 개인 도메인을 애플리케이션에 연결하고 HTTPS를 적용해야 한다.
	- 개인 도메인을 애플리케이션에 연결함. `2호선예약.메인.한국`, `개발.2호선예약.메인.한국`
- [x] 애플리케이션 로그를 파일 또는 수집기로 영속화하고 조회 절차를 제공해야 한다. ✅ 2025-09-03
	- nohup.out 으로 관리하고, CLI 환경에서 확인할 수 있도록 .sh 스크립트 생성
- [ ] 서버 자원(CPU·메모리·네트워크 등)을 지표·대시보드로 시각화해야 한다.
- [ ] 운영 중 스키마 변경 시 데이터 보존 상태로 마이그레이션 및 재배포를 완료해야 한다.
- [ ] 제공 API의 문서 명세를 작성·공개해야 한다.
- [ ] 전체 인프라를 다이어그램으로 작성하고 각 구성요소 역할을 설명해야 한다.


환경 분리는 단순히 .yml 과 프로파일을 분리하고, 개발 서버와 운영 서버를 분리했다.



---


## 폼 제출 정보
배포 서버, PR, AWS 리소스 링크*
```
배포 서버: 2호선예약.메인.한국
개발 서버: 개발.2호선예약.메인.한국

개발 DB EC2: https://ec2-15-165-125-204.ap-northeast-2.compute.amazonaws.com/
개발 WAS EC2: https://ec2-54-180-60-192.ap-northeast-2.compute.amazonaws.com/
배포 DB EC2: https://ec2-3-38-179-122.ap-northeast-2.compute.amazonaws.com/
배포 WAS EC2: https://ec2-13-124-96-5.ap-northeast-2.compute.amazonaws.com/
```


인프라와 서비스 구성 설명*
구축한 인프라와 서비스 구성을 본인의 언어로 설명해 주세요. (문서 또는 AI 대화 기록 활용 가능)
- 작성 방식: 별도의 문서(.md)로 정리하고, 해당 URL을 제출해 주세요.
- 권한이 있는 링크로 제출하는 경우 반드시 **접근 권한이 열려 있는지 확인**해 주세요.
- 답변은 단순 나열이 아니라, **본인의 역량을 설명하는 상황**이라고 생각하고 작성해 주세요.  
(예: “제가 설계한 아키텍처는 …, 이를 통해 장애 상황에서 … 대응할 수 있습니다.”와 같이 설명)


### 작업 동기
로컬에만 구축되어 있던 서비스를 웹 상에 띄워서 실제로 서비스를 운영하고 싶었습니다.

### 작업 과정
#### WAS
실제로 서비스를 운영하려면 먼저 WAS가 배포되어 있어야 합니다.
직접 서버를 구축하려면 많은 비용이 필요하므로 클라우드 컴퓨팅 서비스를 이용하기로 했습니다.
클라우드 서비스 중에서도 가장 보편적으로 사용되고, 우아한테크코스에서 5만원 지원금까지 받을 수 있는 AWS를 선택했습니다.

EC2 인스턴스를 하나 생성했고, 프로젝트를 .jar 빌드하여 WAS를 배포했습니다.

#### DB
서비스에서 데이터를 저장할 DB도 필요합니다. 기존에는 로컬에 구축되어있는 프로젝트였기 때문에 H2 DB를 로컬에서 사용하고 있었습니다. DB를 로컬에서 사용하면 이후 수평 확장 등의 작업에서 문제가 발생할 수 있고, 여러개의 분리된 서비스에서 하나의 DB를 사용하는 상황을 제어하기 힘들기 때문에. DB도 기존 로컬에서 서버로 이전하기로 결정했습니다.

주어진 시간이 부족한 상황에서, 성능도 준수하고 이미 어느정도 익숙해져 있어 러닝 커브가 적은 DB인 MySQL을 사용하기로 선택했습니다. 대안으로는 PostgreSQL이 있었는데, PostgreSQL의 Sequence 등 고급 기능을 현재는 사용할 예정이 전혀 없기 때문에 MySQL로 진행했습니다.

DB를 처음에는 기존 WAS EC2에 같이 설정하려고 했습니다. 이유를 설명하기 위해 역으로 DB와 WAS를 분리하려는 이유를 먼저 생각해보겠습니다. DB와 WAS를 하나의 물리적 서버에 두면, 혹여 서버에 문제가 생겼을 때 둘 다 터져버릴 수 있기 때문이라는 생각이 들었습니다. 하지만 현재는 어차피 WAS와 DB가 1:1 관계라 하나의 라이프사이클을 공유하고 있어, DB나 WAS 둘 중 하나라도 터져도 서비스가 불가능해지기 때문에 의미가 덜하다고 느꼈습니다. DB나 WAS 둘 중 하나라도 덜 터져주면 고마운 상황에서는, 서버를 분리해서 그러한 상황을 막는 게 도움이 되겠지만, 지금은 그럴 필요가 없다고 느꼈거든요.

하지만 이내 생각이 바뀌었습니다. 확장성을 고려하면 나중에 해당 DB를 다른 서버에서 접근할 수도 있기도 하고, 관리자 페이지 등의 부가 기능을 제공한다면 WAS 하나가 터져도 관리자 페이지는 확인하려는 니즈가 있기 때문입니다. 따라서 복잡함을 약간 감수하고 DB와 WAS 서버를 물리적으로 분리하기로 결정했습니다.

결론적으로, DB용 EC2를 생성하고 MySQL을 설정했습니다.

#### WAS <-> DB 연동
기존 로컬 프로젝트는 Local H2를 사용하도록 설정되어 있기 때문에, 이제는 같은 SG(보안그룹)의 EC2의 MySQL을 사용하도록 설정을 바꿔주었습니다.
DB는 외부에서 접근 불가능하고, 내부망에서만 접근 가능하도록 했습니다.

#### 프로필 분리 및 개발 서버 배포
이후 프론트엔드 팀과 작업하게 될 상황을 고려하여, 개발 환경이 웹에 띄워져있으면 협업과 이것저것 실험(부하 테스트) 등을 하기 좋겠다고 생각했습니다. 따라서 개발 서버를 WAS EC2에 띄우려고 했는데, 개발 서버는 다양한 실험적인 기능과 테스트가 있다는 점을 고려하여 개발 서버와 물리적으로 분리했습니다. DB도 분리했습니다.

그리고, .jar 파일 실행 시 환경을 구분하기 위해 profile flag를 `dev`, `prod` 식으로 추가하도록 했습니다.
덕분에 개발 환경에서 어떤 테스트나 실험적인 일을 해도, 운영 서버에는 전혀 영향이 없도록 했습니다.

#### 배포 반자동화
CI/CD pipeline을 구축하는 것은 시간이 부족해서 못했지만, 배포 편의성을 위한 최소한의 조치는 취했습니다. 
deploy.sh 스크립트를 각 환경의 EC2에 작성했고, github의 브랜치에서 자동으로 최신 버전을 반영하여 배포하도록 설정했습니다.

#### 로그 기록 및 확인
AWS CloudWatch 같은 모니터링 도구를 사용하진 않았지만, nohup.out으로 서버의 로그가 기록되도록 하였고, 외부에 쉘 스크립트를 두어 해당 로그를 쉽게 확인할 수 있도록 설정했습니다.
 