동시성 제어에 관련해서 깊은 고민을 했다.

A 유저가 호텔 방에 대해 예약 요청을 보냈다고 하자.
그 호텔 방에는 이미 예약이 DB에 등록되어있지만, 이미 만료된 예약이라서 A유저는 계속 예약을 진행할 수 있다.
따라서 A 유저의 로직은 
1. 만료된 예약 DELETE
2. 내 예약 INSERT
인데,

만약 B 유저가 똑같이 호텔 방에 대해 예약 요청을 보냈다면. B 유저도 트랜잭션 중에 만료된 예약을 DELETE 하는 요청을 보낼 것이다.

물론 예약에 UNIQUE CONSTRAINT가 걸려있어서, 하나의 예약만 성공할 수 있기에 둘 중 하나의 트랜잭션은 롤백되겠지만, 만약 락이 걸려있지 않다면 같은 행이 두번 삭제되고 하나는 복구되는 복잡한 상황은 DB가 어떻게 처리하는지에 대해 멘붕이 왔다..

근데 찾아보니까 은근 간단하게 해결하고 있었다.

DB는 **"특정 Row를 수정/삭제하려고 할 때, 그 Row에 락(Row-Level Lock)을 획득해야만 한다"**는 대원칙이 있습니다.


