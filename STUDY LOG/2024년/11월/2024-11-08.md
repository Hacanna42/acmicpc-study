# <span style="color:yellow">2024-11-08</span>
11/08 오늘의 목표
1. 코드리뷰 2개 반사
2. 4주차 미션 80% 구현
3. 테스트 코드 작성

파이팅 !

- - -

어제 들었던 문제에 대한 의문점 중 제일 풀리지 않던것은
1. 프로모션 기간이 끝나면 해당 재고는 소멸하는 것인가? 아니면 일반 재고로 변환되는 것인가? 이다.

테스트 코드에서 어느정도의 단서를 발견했는데... 

```java
@Test  
void 기간에_해당하지_않는_프로모션_적용() {  
    assertNowTest(() -> {  
        run("[감자칩-2]", "N", "N");  
        assertThat(output().replaceAll("\s", "")).contains("내실돈3,000");  
    }, LocalDate.of(2024, 2, 1).atStartOfDay());  
}
```

이 테스트 코드는 두가지의 구현 경우: 
1. 프로모션이 끝나서 해당 재고가 소멸됐다.
2. 프로모션이 끝나서 해당 재고가 비프로모션으로 변환됐다.
를 다 만족시키는 테스트코드다 .. 즉 프로모션 만료 상품에 대해 어떻게 처리할지는 우테코 요구사항에 나와있지 않고 개인이 판단해야하는 부분 같다.

그러면 이어서 따라오는 의문점은.. 만약 오늘 날짜 기준에서 프로모션이 만료되었다면, 프로그램 시작점에 있는 재고 안내에서부터 프로모션 정보를 없애야 하지 않을까?
= 이것도 구체적인 요구 사항이 없다... 그냥 단순히 출력하고 이후에 체크하는 게 나은 것 같다.


너무 복잡하다 .. 정리를 좀 해야겠다.







- - -

입/출력 담당의 View는 InputView와 OutputView에 의존하여 모든 입출력 역할을 담당한다.
StoreController는 View에게 사용자의 주문 내역을 받아오도록 시킨다.
받아온 주문 내역은 OrderItem이라는 객체에 (이름, 수량) 형태로 저장된다.
StoreController는 StoreService에게 주문을 시킨다.

주문은 다음과 같은 과정을 거쳐야 한다.

1. 실제로 상품이 재고에 있는지 확인해야 한다.
= 이름과 똑같은 상품이 있는지 검색해야 한다. 프로모션 상품과 비프로모션 상품이 있을 수 있다. 프로모션 만약 둘 다 있는 경우라면 둘의 재고를 모두 합하여 어떻게든 사용자가 입력한 수만큼 구매 가능한지 파악한다.

2. Stock 객체는 다양한 상황을 고려해서 OrderStatus 객체를 반환해야 한다.
= StoreService 객체는 OrderStatus를 적절히 받아서 다양한 조건에 대해 질문하고 특정 개수만큼 구매한다.

3. 구매를 해야한다
= Product에 "구매" 메시지를 만든다. 구매 메시지는 다음과 같은 행동을 한다:
1. 실제 Product의 Quantity 필드를 구매 수량만큼 차감한다.
2. 구매 비용을 계산하고 반환한다.
3. 프로모션 할인 비용을 계산하고 반환한다.

4. 영수증에 내역을 추가해야 한다.
1. Product의 메시지에서 처리하면 좋겠지만, 그러면 비-프로모션 제품 두개를 몽땅 사는 경우를 처리할 수 없다. 따라서 StoreService에 추가해야 할 것 같다.

- - -

테스트코드 작성에 부담이 생겼다. 문제가 워낙 복잡하고 요구 사항에 대한 이해도 계속 달라지고 헷갈리는 상황에서 테스트코드를 작성하는게 맞는가 싶지만.. 일단 기능 구현 70% 정도 완성된 현재 상황에서 테스트 코드를 작성해보려고 한다. (TDD는 물 건너갔다)



#### 제일 주된 고민:
프로모션이 끝나면 프로모션 재고에 아예 손도 댈 수 없는것인지 프로모션을 미적용하고 재고에 손을 댈 수 있는 것인지?

오늘은 거의 73% 정도 구현한 것 같다. 테스트 코드 작성에 집중하는 중.

이제 결제 처리와 영수증만 하면 구현 완료다. 코드가 너무 스파게티 같고 반례도 있을 것 같지만 일단 구현을 끝내고 리팩토링을 시작해보자 ..! (새벽 4시 56분 퇴근.)

거의 오늘 하루종일 코딩했다.




